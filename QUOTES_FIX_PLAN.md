# План исправления проблемы с файлами с кавычками

## Проблема

Medium with quotes (1000 rows): **3.08x медленнее** (1.71ms -> 5.28ms)

## Анализ

### Возможная причина 1: `has_unclosed_quotes` возвращает True
- Если `has_unclosed_quotes` возвращает True, используется построчное чтение
- Построчное чтение добавляет огромный overhead Python-C++ вызовов
- Каждая строка парсится отдельно через `parse_line_quotes_no_escape`

### Возможная причина 2: Неправильная реализация `has_unclosed_quotes`
- Функция считает количество кавычек
- Если количество нечетное, возвращает True
- Но может неправильно обрабатывать экранированные кавычки

### Возможная причина 3: Batch обработка не используется
- Для файлов с кавычками batch обработка отключена (откат Приоритета 2)
- Используется построчное чтение через `_read_and_parse_chunk`
- Это добавляет overhead

## Решение 1: Оптимизировать `has_unclosed_quotes`

Проверить и оптимизировать функцию, чтобы она правильно определяла закрытые кавычки.

## Решение 2: Использовать batch обработку для файлов с кавычками

Но это уже пробовали и откатили. Нужен другой подход.

## Решение 3: Упростить проверку для маленьких файлов

Для файлов <500KB можно пропустить проверку `has_unclosed_quotes` и всегда использовать batch обработку.

## Рекомендация

Начать с Решения 3 - для маленьких файлов (<500KB) всегда использовать batch обработку, даже если есть кавычки. Это должно значительно ускорить файлы с кавычками.




