# Анализ финальных результатов оптимизации

## Результаты двух прогонов

### Прогон 1
- **Large (10000 rows)**: 5.74x быстрее
- **Medium (1000 rows)**: 1.30x быстрее
- **Medium with quotes**: 1.18x медленнее
- **Medium with unicode**: 1.02x медленнее
- **Быстрее**: 5/8

### Прогон 2
- **Large (10000 rows)**: 8.19x быстрее ✅ (отличный результат!)
- **Medium (1000 rows)**: 1.45x быстрее
- **Medium with quotes**: 2.16x медленнее ⚠️ (серьезная регрессия!)
- **Medium with unicode**: 1.09x быстрее
- **Быстрее**: 6/8

## Анализ проблем

### 1. Высокая вариативность Large файлов
- **Диапазон**: 5.74x - 8.19x быстрее
- **Среднее**: ~6.97x быстрее
- **Вариативность**: ±1.23x (около 18%)
- **Статус**: ⚠️ Высокая вариативность, но хорошие результаты

### 2. Регрессия Medium with quotes
- **Прогон 1**: 1.18x медленнее (приемлемо)
- **Прогон 2**: 2.16x медленнее ⚠️ (серьезная регрессия!)
- **Статус**: ⚠️ Нестабильно, возможна серьезная регрессия

### 3. Стабильные результаты
- **Small (100 rows)**: 1.50x - 1.57x быстрее (стабильно)
- **Medium (1000 rows)**: 1.30x - 1.45x быстрее (стабильно)
- **Medium (2000 rows)**: 1.12x - 1.14x быстрее (стабильно)

## Возможные причины проблем

### 1. Medium with quotes регрессия
Возможные причины:
- Дополнительная оптимизация для больших файлов могла повлиять на batch обработку файлов с кавычками
- Изменения в резервировании могли затронуть код для файлов с кавычками
- Системные факторы (кэш, загрузка CPU)

### 2. Вариативность Large файлов
Возможные причины:
- Системные факторы (кэш, загрузка CPU, другие процессы)
- Размер файла на границе оптимизации (10000 строк)
- Вариативность в резервировании памяти

## Рекомендации

### Вариант 1: Откатить дополнительную оптимизацию для больших файлов ⚠️
**Плюсы:**
- Вернет стабильность для Medium with quotes
- Устранит регрессию

**Минусы:**
- Потеряем улучшение для Large файлов (8.19x во втором прогоне)

### Вариант 2: Оставить изменения, но улучшить стабильность ✅
**Действия:**
- Проверить, не влияет ли оптимизация на файлы с кавычками
- Убедиться, что изменения применяются только к файлам без кавычек
- Добавить дополнительные проверки

### Вариант 3: Уточнить логику оптимизации
**Действия:**
- Убедиться, что оптимизация применяется только для файлов без кавычек
- Проверить, что для файлов с кавычками используется отдельная логика
- Возможно, нужно добавить проверку на размер файла перед применением оптимизации

## Выводы

1. **Large файлы**: Показывают хорошие результаты (до 8.19x), но высокая вариативность
2. **Medium with quotes**: Серьезная регрессия во втором прогоне (2.16x медленнее)
3. **Другие файлы**: Стабильные результаты

## Рекомендация

**Проверить код**, чтобы убедиться, что дополнительная оптимизация для больших файлов применяется **только к файлам без кавычек** и не влияет на batch обработку файлов с кавычками.

Если оптимизация влияет на файлы с кавычками, нужно либо:
1. Добавить проверку, чтобы оптимизация применялась только к файлам без кавычек
2. Или откатить изменения, если они влияют на другие части кода



